# ULTIMATE FAST GITHUB METRICS WORKFLOW
# Uses centralized profile config from .github/config/profiles.yml
name: GitHub Metrics (Ultimate Fast)
on:
  schedule:
    - cron: "0 8 1/2 * *" # Every 2 days at 8 AM
  workflow_dispatch:

jobs:
  github-metrics:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Install yq (YAML parser)
        run: |
          sudo wget -qO /usr/local/bin/yq https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64
          sudo chmod +x /usr/local/bin/yq

      - name: Read profile configuration
        id: config
        run: |
          echo "github_user=$(yq '.github.username' .github/config/profiles.yml)" >> $GITHUB_OUTPUT
          echo "leetcode_user=$(yq '.leetcode.username' .github/config/profiles.yml)" >> $GITHUB_OUTPUT
          echo "timezone=$(yq '.personal.timezone' .github/config/profiles.yml)" >> $GITHUB_OUTPUT
          echo "✅ Loaded config - LeetCode user: $(yq '.leetcode.username' .github/config/profiles.yml)"

      - name: Ensure metrics directory exists
        run: mkdir -p metrics

      # SINGLE STEP - ALL METRICS GENERATED AT ONCE
      - name: ⚡ Generate ALL metrics (fastest possible)
        uses: lowlighter/metrics@latest
        with:
          filename: metrics/github-metrics.svg
          token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
          user: ${{ steps.config.outputs.github_user }}
          config_timezone: ${{ steps.config.outputs.timezone }}
          config_display: large
          committer_message: "chore: update metrics"
          template: classic
          base: header, activity, community, repositories, metadata

          # All plugins combined for maximum speed
          plugin_languages: yes
          plugin_languages_ignored: html, css, tex, less, dockerfile, makefile, qmake, lex, cmake, shell, gnuplot, batchfile
          plugin_languages_details: bytes-size, percentage
          plugin_languages_limit: 8
          plugin_languages_sections: most-used, recently-used
          plugin_achievements: yes
          plugin_achievements_display: detailed
          plugin_achievements_threshold: C
          plugin_isocalendar: yes
          plugin_isocalendar_duration: full-year
          plugin_habits: yes
          plugin_habits_facts: yes
          plugin_habits_charts: yes
          plugin_activity: yes
          plugin_activity_limit: 8
          plugin_activity_days: 30
          plugin_activity_filter: issue, pr, release, fork, review, ref/create
          plugin_stars: yes
          plugin_stars_limit: 4
          plugin_topics: yes
          plugin_topics_limit: 20
          plugin_topics_mode: icons
          plugin_people: yes
          plugin_people_types: followers
          plugin_reactions: yes
          plugin_reactions_limit: 100
          plugin_reactions_details: percentage
          plugin_repositories: yes
          plugin_repositories_pinned: 6
          plugin_lines: yes
          plugin_lines_delay: 30
          plugin_followup: yes
          plugin_discussions: yes
          plugin_discussions_categories_limit: 8
          plugin_notable: yes
          plugin_gists: yes
          plugin_introduction: yes
          plugin_stargazers: yes
          plugin_leetcode: yes
          plugin_leetcode_user: ${{ steps.config.outputs.leetcode_user }}
          plugin_leetcode_sections: solved, skills, recent

          output_action: commit
          committer_branch: main
          delay: 15
          plugins_errors_fatal: no
